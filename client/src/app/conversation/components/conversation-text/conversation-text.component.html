<!-- <pre>
  {{ conversation() | json }}
</pre> -->
@if(conversation()?.messages!.length > 0) {
  <div class="ion-padding">
      <ion-grid>
        @for(message of conversation()?.messages; track message.id) {
          @if(message.role === 'user') {
            <ion-row [id]="message.id">
              <ion-col offset="3" size="9" style="text-align: right;">
                  <div class="user-message">
                    <div>{{ message.content }}</div>
                  </div>
              </ion-col>
            </ion-row>
            <!-- This displays files that were just uploaded for the conversation -->
            @if(message.data?.dataSources?.length) {
              <b>Included documents:</b><br>
              @for(file of message.data.dataSources; track file.id) {
                <ion-chip (click)="downloadFile(file)">
                  <ion-icon [name]="file.type | fileTypeIcon"></ion-icon>
                  <ion-label>{{ file.name }}</ion-label>
                </ion-chip>
              }
            }
          } @else {
            <ion-row class="assistant-response-row">
              <ion-col size="12">
                <div class="assistant-message">
                  <!-- This displays files that were selected from previously uploaded files and also not listed in the datasources -->
                  @if(message.data?.state?.sources?.documentContext?.sources?.length && !message.data?.dataSources?.length) {
                    <b>Included documents:</b><br>
                    @for(file of message.data.state.sources.documentContext.sources; let i = $index; track i) {
                      <ion-chip (click)="downloadFile(file)">
                        <ion-icon [name]="file.type | fileTypeIcon"></ion-icon>
                        <ion-label>{{ file.name }}</ion-label>
                      </ion-chip>
                    }
                  }
                  @if(loading()) {
                    <ion-spinner name="circular"></ion-spinner>
                  }
                  <markdown clipboard mermaid [data]="message.content"></markdown>
                </div>
              </ion-col>
            </ion-row>
          }
        }
      </ion-grid>
  </div>
}
